{{ if .Site.Params.enableGitalk }}
<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='{{ "css/gitalk.css" | absURL }}'>
<script src='{{ "js/gitalk.min.js" | absURL }}'></script>
<script>
  // 修正：参数改为小写gitalk，匹配hugo.toml配置
  const gitalk = new Gitalk({
    clientID: '{{ .Site.Params.gitalk.clientID }}',
    clientSecret: '{{ .Site.Params.gitalk.clientSecret }}',
    repo: '{{ .Site.Params.gitalk.repo }}',
    owner: '{{ .Site.Params.gitalk.owner }}',
    admin: {{ .Site.Params.gitalk.admin }}, // 直接读取admin数组，无需手动写
    // 修正：用文章URL路径作为唯一ID（确保匹配Issues，长度<50）
    id: window.location.pathname.substring(0, 50), 
    distractionFreeMode: false
  });
  // 确保DOM加载完成后渲染
  document.addEventListener('DOMContentLoaded', function() {
    gitalk.render('gitalk-container');
  });
</script>
{{ end }}